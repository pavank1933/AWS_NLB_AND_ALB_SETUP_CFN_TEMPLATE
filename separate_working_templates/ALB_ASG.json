{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Resources":{
      "LaunchConfigurationOne":{
         "Type":"AWS::AutoScaling::LaunchConfiguration",
         "Properties":{
            "ImageId":{
               "Ref":"Ami"
            },
            "KeyName":"us-east-2-test",
            "SecurityGroups":[
               "sg-03cb004f52"
            ],
            "InstanceType":{
               "Ref":"InstanceType"
            },
            "InstanceMonitoring":false,
            "EbsOptimized":false
         }
      },
      "AutoScalingGroupOne":{
         "Type":"AWS::AutoScaling::AutoScalingGroup",
         "Properties":{
            "LaunchConfigurationName":{
               "Ref":"LaunchConfigurationOne"
            },
            "TargetGroupARNs":[
               {
                  "Ref":"TargetGroup"
               }
            ],
            "MaxSize":2,
            "MinSize":2,
            "DesiredCapacity":2,
            "Cooldown":300,
            "AvailabilityZones":{
               "Fn::GetAZs":{
                  "Ref":"AWS::Region"
               }
            },
            "HealthCheckType":"EC2",
            "HealthCheckGracePeriod":300,
            "Tags":[
               {
                  "Key":"Env",
                  "Value":{
                     "Ref":"Env"
                  },
                  "PropagateAtLaunch":true
               },
               {
                  "Key":"Name",
                  "Value":{
                     "Ref":"Env"
                  },
                  "PropagateAtLaunch":true
               },
               {
                  "Key":"Version",
                  "Value":{
                     "Ref":"Version"
                  },
                  "PropagateAtLaunch":true
               }
            ],
            "TerminationPolicies":[
               "Default"
            ]
         }
      },
      "LaunchConfigurationTwo":{
         "Type":"AWS::AutoScaling::LaunchConfiguration",
         "Properties":{
            "ImageId":{
               "Ref":"Ami"
            },
            "KeyName":"us-east-2-pavan-test",
            "SecurityGroups":[
               "sg-03cb004f52"
            ],
            "InstanceType":{
               "Ref":"InstanceType"
            },
            "InstanceMonitoring":false,
            "EbsOptimized":false
         }
      },
      "AutoScalingGroupTwo":{
         "Type":"AWS::AutoScaling::AutoScalingGroup",
         "Properties":{
            "LaunchConfigurationName":{
               "Ref":"LaunchConfigurationTwo"
            },
            "TargetGroupARNs":[
               {
                  "Ref":"TargetGroup"
               }
            ],
            "MaxSize":2,
            "MinSize":2,
            "DesiredCapacity":2,
            "Cooldown":300,
            "AvailabilityZones":{
               "Fn::GetAZs":{
                  "Ref":"AWS::Region"
               }
            },
            "HealthCheckType":"EC2",
            "HealthCheckGracePeriod":300,
            "Tags":[
               {
                  "Key":"Env",
                  "Value":"UAT-ENV",
                  "PropagateAtLaunch":true
               },
               {
                  "Key":"Name",
                  "Value":"UAT-TEST",
                  "PropagateAtLaunch":true
               },
               {
                  "Key":"Version",
                  "Value":"UAT-VER",
                  "PropagateAtLaunch":true
               }
            ],
            "TerminationPolicies":[
               "Default"
            ]
         }
      },
      "TargetGroup":{
         "Type":"AWS::ElasticLoadBalancingV2::TargetGroup",
         "Properties":{
            "Port":80,
            "Protocol":"HTTP",
            "VpcId":"vpc-4c227",
            "HealthCheckProtocol":"HTTP",
            "HealthCheckPort":"traffic-port",
            "HealthCheckIntervalSeconds":30,
            "HealthCheckTimeoutSeconds":5,
            "HealthyThresholdCount":5,
            "UnhealthyThresholdCount":2,
            "HealthCheckPath":"/",
            "Matcher":{
               "HttpCode":"200,404"
            },
            "TargetType":"instance"
         }
      },
      "LoadBalancer":{
         "Type":"AWS::ElasticLoadBalancingV2::LoadBalancer",
         "Properties":{
            "Scheme":"internet-facing",
            "Type":"application",
            "Subnets":[
               "subnet-49922",
               "subnet-9f4dc",
               "subnet-a12d3"
            ],
            "SecurityGroups":[
               "sg-03cb004f52"
            ],
            "IpAddressType":"ipv4"
         }
      },
      "Listener":{
         "Type":"AWS::ElasticLoadBalancingV2::Listener",
         "Properties":{
            "LoadBalancerArn":{
               "Ref":"LoadBalancer"
            },
            "Port":80,
            "Protocol":"HTTP",
            "DefaultActions":[
               {
                  "Type":"forward",
                  "TargetGroupArn":{
                     "Ref":"TargetGroup"
                  }
               }
            ]
         }
      }
   },
   "Parameters":{
      "Ami":{
         "Type":"String",
         "Default":"ami-02eeae6d5096"
      },
      "InstanceType":{
         "Type":"String",
         "Default":"t2.micro",
         "AllowedValues":[
            "t2.micro",
            "m1.small",
            "m1.large"
         ],
         "Description":"Enter t2.micro, m1.small, or m1.large. Default is t2.micro."
      },
      "Env":{
         "Type":"String",
         "Default":"prod-test",
         "Description":"Environment"
      },
      "Version":{
         "Type":"String",
         "Default":"prod-ver",
         "Description":"Version"
      }
   }
}
