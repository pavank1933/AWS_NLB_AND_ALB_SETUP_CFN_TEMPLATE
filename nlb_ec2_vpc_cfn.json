{ 
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"AWS CloudFormation Template",
   "Parameters":{ 
      "InstanceType":{ 
         "Description":"EC2 instance type",
         "Type":"String",
         "Default":"t2.micro",
         "AllowedValues":[ 
            "t1.micro",
            "t2.micro",
            "m1.small",
            "m1.medium",
            "m1.large",
            "m1.xlarge",
            "m2.xlarge",
            "m2.2xlarge",
            "m2.4xlarge",
            "m3.xlarge",
            "m3.2xlarge",
            "c1.medium",
            "c1.xlarge",
            "cc1.4xlarge",
            "cc2.8xlarge",
            "cg1.4xlarge"
         ],
         "ConstraintDescription":"must be a valid EC2 instance type."
      },
      "KeyName":{ 
         "Description":"Name of an existing EC2 KeyPair to enable SSH access to the instance",
         "Type":"String",
         "Default":"us-west-2-pavan-test"
      }
   },
   "Mappings":{ 
      "RegionMap":{ 
         "us-east-1":{ 
            "AMI":"ami-7f418316"
         },
         "us-west-1":{ 
            "AMI":"ami-951945d0"
         },
         "us-west-2":{ 
            "AMI":"ami-08d489468314a58df"
         },
         "eu-west-1":{ 
            "AMI":"ami-24506250"
         },
         "sa-east-1":{ 
            "AMI":"ami-3e3be423"
         },
         "ap-southeast-1":{ 
            "AMI":"ami-74dda626"
         },
         "ap-southeast-2":{ 
            "AMI":"ami-b3990e89"
         },
         "ap-northeast-1":{ 
            "AMI":"ami-dcfa4edd"
         }
      }
   },
   "Resources":{ 
      "VPC":{ 
         "Type":"AWS::EC2::VPC",
         "Properties":{ 
            "EnableDnsSupport":true,
            "EnableDnsHostnames":true,
            "CidrBlock":"10.10.0.0/16"
         }
      },
      "InternetGateway":{ 
         "Type":"AWS::EC2::InternetGateway"
      },
      "GatewayAttachement":{ 
         "Type":"AWS::EC2::VPCGatewayAttachment",
         "Properties":{ 
            "VpcId":{ 
               "Ref":"VPC"
            },
            "InternetGatewayId":{ 
               "Ref":"InternetGateway"
            }
         }
      },
      "SubnetOne":{ 
         "Type":"AWS::EC2::Subnet",
         "Properties":{ 
            "AvailabilityZone":{ 
               "Fn::Select":[ 
                  0,
                  { 
                     "Fn::GetAZs":{ 
                        "Ref":"AWS::Region"
                     }
                  }
               ]
            },
            "VpcId":{ 
               "Ref":"VPC"
            },
            "CidrBlock":"10.10.1.0/24",
            "MapPublicIpOnLaunch":true
         }
      },
      "SubnetTwo":{ 
         "Type":"AWS::EC2::Subnet",
         "Properties":{ 
            "AvailabilityZone":{ 
               "Fn::Select":[ 
                  0,
                  { 
                     "Fn::GetAZs":{ 
                        "Ref":"AWS::Region"
                     }
                  }
               ]
            },
            "VpcId":{ 
               "Ref":"VPC"
            },
            "CidrBlock":"10.10.2.0/24",
            "MapPublicIpOnLaunch":true
         }
      },
      "SubnetThree":{ 
         "Type":"AWS::EC2::Subnet",
         "Properties":{ 
            "AvailabilityZone":{ 
               "Fn::Select":[ 
                  1,
                  { 
                     "Fn::GetAZs":{ 
                        "Ref":"AWS::Region"
                     }
                  }
               ]
            },
            "VpcId":{ 
               "Ref":"VPC"
            },
            "CidrBlock":"10.10.3.0/24"
         }
      },
      "SubetOneVmOne":{ 
         "Type":"AWS::EC2::Instance",
         "Properties":{ 
            "ImageId":"ami-08d489468314a58df",
            "SubnetId":{ 
               "Ref":"SubnetOne"
            },
            "InstanceType":{ 
               "Ref":"InstanceType"
            },
            "KeyName":{ 
               "Ref":"KeyName"
            },
            "Tags":[ 
               { 
                  "Key":"Application",
                  "Value":{ 
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "SubetOneVmTwo":{ 
         "Type":"AWS::EC2::Instance",
         "Properties":{ 
            "ImageId":"ami-08d489468314a58df",
            "SubnetId":{ 
               "Ref":"SubnetOne"
            },
            "InstanceType":{ 
               "Ref":"InstanceType"
            },
            "KeyName":{ 
               "Ref":"KeyName"
            },
            "Tags":[ 
               { 
                  "Key":"Application",
                  "Value":{ 
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "SubetTwoVmOne":{ 
         "Type":"AWS::EC2::Instance",
         "Properties":{ 
            "ImageId":"ami-08d489468314a58df",
            "SubnetId":{ 
               "Ref":"SubnetTwo"
            },
            "InstanceType":{ 
               "Ref":"InstanceType"
            },
            "KeyName":{ 
               "Ref":"KeyName"
            },
            "Tags":[ 
               { 
                  "Key":"Application",
                  "Value":{ 
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "SubetTwoVmTwo":{ 
         "Type":"AWS::EC2::Instance",
         "Properties":{ 
            "ImageId":"ami-08d489468314a58df",
            "SubnetId":{ 
               "Ref":"SubnetTwo"
            },
            "InstanceType":{ 
               "Ref":"InstanceType"
            },
            "KeyName":{ 
               "Ref":"KeyName"
            },
            "Tags":[ 
               { 
                  "Key":"Application",
                  "Value":{ 
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "SubetThreeVmOne":{ 
         "Type":"AWS::EC2::Instance",
         "Properties":{ 
            "ImageId":"ami-08d489468314a58df",
            "SubnetId":{ 
               "Ref":"SubnetThree"
            },
            "InstanceType":{ 
               "Ref":"InstanceType"
            },
            "KeyName":{ 
               "Ref":"KeyName"
            },
            "Tags":[ 
               { 
                  "Key":"Application",
                  "Value":{ 
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "SubetThreeVmTwo":{ 
         "Type":"AWS::EC2::Instance",
         "Properties":{ 
            "ImageId":"ami-08d489468314a58df",
            "SubnetId":{ 
               "Ref":"SubnetThree"
            },
            "InstanceType":{ 
               "Ref":"InstanceType"
            },
            "KeyName":{ 
               "Ref":"KeyName"
            },
            "Tags":[ 
               { 
                  "Key":"Application",
                  "Value":{ 
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "NetworkLoadBalancer":{ 
         "Type":"AWS::ElasticLoadBalancingV2::LoadBalancer",
         "Properties":{ 
            "Name":"SamNetworkloadbalancer",
            "Scheme":"internet-facing",
            "Subnets":[ 
               { 
                  "Ref":"SubnetOne"
               },
               { 
                  "Ref":"SubnetThree"
               }
            ],
            "Type":"network",
            "Tags":[ 
               { 
                  "Key":"Name",
                  "Value":"network-elb"
               }
            ]
         }
      },
      "TargetGroupOne":{ 
         "Type":"AWS::ElasticLoadBalancingV2::TargetGroup",
         "Properties":{ 
            "Name":"MyTargetsOne",
            "Port":80,
            "Protocol":"TCP",
            "TargetGroupAttributes":[ 
               { 
                  "Key":"deregistration_delay.timeout_seconds",
                  "Value":"20"
               }
            ],
            "Targets":[ 
               { 
                  "Id":{ 
                     "Ref":"SubetOneVmOne"
                  },
                  "Port":80
               },
               { 
                  "Id":{ 
                     "Ref":"SubetTwoVmOne"
                  },
                  "Port":80
               },
               { 
                  "Id":{ 
                     "Ref":"SubetThreeVmOne"
                  },
                  "Port":80
               }
            ],
            "VpcId":{ 
               "Ref":"VPC"
            }
         }
      },
      "TargetGroupTwo":{ 
         "Type":"AWS::ElasticLoadBalancingV2::TargetGroup",
         "Properties":{ 
            "Name":"MyTargetsTwo",
            "Port":2100,
            "Protocol":"TCP",
            "TargetGroupAttributes":[ 
               { 
                  "Key":"deregistration_delay.timeout_seconds",
                  "Value":"20"
               }
            ],
            "Targets":[ 
               { 
                  "Id":{ 
                     "Ref":"SubetOneVmTwo"
                  },
                  "Port":2100
               },
               { 
                  "Id":{ 
                     "Ref":"SubetTwoVmTwo"
                  },
                  "Port":2100
               },
               { 
                  "Id":{ 
                     "Ref":"SubetThreeVmTwo"
                  },
                  "Port":2100
               }
            ],
            "VpcId":{ 
               "Ref":"VPC"
            }
         }
      },
      "ListenerOne":{ 
         "Type":"AWS::ElasticLoadBalancingV2::Listener",
         "Properties":{ 
            "DefaultActions":[ 
               { 
                  "Type":"forward",
                  "TargetGroupArn":{ 
                     "Ref":"TargetGroupOne"
                  }
               }
            ],
            "LoadBalancerArn":{ 
               "Ref":"NetworkLoadBalancer"
            },
            "Port":"80",
            "Protocol":"TCP"
         }
      },
      "ListenerTwo":{ 
         "Type":"AWS::ElasticLoadBalancingV2::Listener",
         "Properties":{ 
            "DefaultActions":[ 
               { 
                  "Type":"forward",
                  "TargetGroupArn":{ 
                     "Ref":"TargetGroupTwo"
                  }
               }
            ],
            "LoadBalancerArn":{ 
               "Ref":"NetworkLoadBalancer"
            },
            "Port":"2100",
            "Protocol":"TCP"
         }
      }
   },
   "Outputs":{ 
      "URL":{ 
         "Value":{ 
            "Fn::Join":[ 
               "",
               [ 
                  "http://",
                  { 
                     "Fn::GetAtt":[ 
                        "SubetOneVmOne",
                        "PublicIp"
                     ]
                  }
               ]
            ]
         },
         "Description":"Newly created application URL.This is given for testing the whole template..."
      }
   }
}